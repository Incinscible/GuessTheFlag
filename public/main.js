let pays = {
	"AD" : "Andorre",
	"AE" : "Emirats Arabes Unis",
	"AF" : "Afghanistan",
	"AG" : "Antigua-Et-Barbuda",
	"AI" : "Anguilla",
	"AL" : "Albanie",
	"AM" : "Arménie",
	"AO" : "Angola",
	"AR" : "Argentine",
	"AT" : "Autriche",
	"AU" : "Australie",
	"AW" : "Aruba",
	"AZ" : "Azerbaïdjan",
	"BA" : "Bosnie-Herzégovine",
	"BB" : "Barbade",
	"BD" : "Bangladesh",
	"BE" : "Belgique",
	"BF" : "Burkina Faso",
	"BG" : "Bulgarie",
	"BH" : "Bahreïn",
	"BI" : "Burundi",
	"BJ" : "Bénin",
	"BN" : "Bruneï",
	"BO" : "Bolivie",
	"BR" : "Brésil",
	"BS" : "Bahamas",
	"BT" : "Bhoutan",
	"BW" : "Botswana",
	"BY" : "Biélorussie",
	"BZ" : "Belize",
	"CA" : "Canada",
	"CD" : "République Démocratique Du Congo",
	"CF" : "République Centrafricaine",
	"CG" : "Congo",
	"CH" : "Suisse",
	"CI" : "Côte D'Ivoire",
	"CL" : "Chili",
	"CM" : "Cameroun",
	"CN" : "Chine",
	"CO" : "Colombie",
	"CR" : "Costa Rica",
	"CU" : "Cuba",
	"CV" : "Cap-Vert",
	"CY" : "Chypre",
	"CZ" : "République Tchèque",
	"DE" : "Allemagne",
	"DJ" : "Djibouti",
	"DK" : "Danemark",
	"DM" : "Dominique",
	"DO" : "République Dominicaine",
	"DZ" : "Algérie",
	"EC" : "Equateur",
	"EE" : "Estonie",
	"EG" : "Egypte",
	"EH" : "Sahara Occidental",
	"ER" : "Erythrée",
	"ES" : "Espagne",
	"ET" : "Éthiopie",
	"FI" : "Finlande",
	"FJ" : "Fidji",
	"FM" : "Micronésie",
	"FR" : "France",
	"GA" : "Gabon",
	"GB" : "Royaume-Uni",
	"GD" : "Grenade",
	"GE" : "Géorgie",
	"GF" : "Guyane",
	"GH" : "Ghana",
	"GI" : "Gibraltar",
	"GL" : "Groenland",
	"GM" : "Gambie",
	"GN" : "Guinée",
	"GP" : "Guadeloupe",
	"GQ" : "Guinée Équatoriale",
	"GR" : "Grèce",
	"GT" : "Guatemala",
	"GW" : "Guinée-Bissau",
	"GY" : "Guyana",
	"HN" : "Honduras",
	"HR" : "Croatie",
	"HT" : "Haïti",
	"HU" : "Hongrie",
	"ID" : "Indonésie",
	"IE" : "Irlande",
	"IL" : "Israël",
	"IM" : "Île De Ma Grosse Bite",
	"IN" : "Inde",
	"IQ" : "Irak",
	"IR" : "Iran",
	"IS" : "Islande",
	"IT" : "Italie",
	"JM" : "Jamaïque",
	"JO" : "Jordanie",
	"JP" : "Japon",
	"KE" : "Kenya",
	"KG" : "Kirghizistan",
	"KH" : "Cambodge",
	"KI" : "Kiribati",
	"KM" : "Comores",
	"KN" : "Saint-Christophe-et-Niévès",
	"KP" : "Corée du Nord",
	"KR" : "Corée du Sud",
	"KW" : "Koweït",
	"KZ" : "Kazakhstan",
	"LA" : "Laos",
	"LB" : "Liban",
	"LC" : "Sainte-Lucie",
	"LI" : "Liechtenstein",
	"LK" : "Sri Lanka",
	"LR" : "Liberia",
	"LS" : "Lesotho",
	"LT" : "Lituanie",
	"LU" : "Luxembourg",
	"LV" : "Lettonie",
	"LY" : "Libye",
	"MA" : "Maroc",
	"MC" : "Monaco",
	"MD" : "Moldavie",
	"ME" : "Monténégro",
	"MG" : "Madagascar",
	"MH" : "Îles Marshall",
	"MK" : "Macédoine",
	"ML" : "Mali",
	"MM" : "Birmanie",
	"MN" : "Mongolie",
	"MR" : "Mauritanie",
	"MT" : "Malte",
	"MU" : "Maurice",
	"MV" : "Maldives",
	"MW" : "Malawi",
	"MX" : "Mexique",
	"MY" : "Malaisie",
	"MZ" : "Mozambique",
	"NA" : "Namibie",
	"NE" : "Niger",
	"NG" : "Nigéria",
	"NI" : "Nicaragua",
	"NL" : "Pays-Bas",
	"NO" : "Norvège",
	"NP" : "Népal",
	"NR" : "Nauru",
	"NZ" : "Nouvelle-Zélande",
	"OM" : "Oman",
	"PA" : "Panama",
	"PE" : "Pérou",
	"PG" : "Papouasie-Nouvelle-Guinée",
	"PH" : "Philippines",
	"PK" : "Pakistan",
	"PL" : "Pologne",
	"PR" : "Porto Rico",
	"PS" : "Palestine",
	"PT" : "Portugal",
	"PW" : "Palaos",
	"PY" : "Paraguay",
	"QA" : "Qatar",
	"RO" : "Roumanie",
	"RS" : "Serbie",
	"RU" : "Russie",
	"RW" : "Rwanda",
	"SA" : "Arabie Saoudite",
	"SB" : "Îles Salomon",
	"SC" : "Seychelles",
	"SD" : "Soudan",
	"SE" : "Suède",
	"SG" : "Singapour",
	"SI" : "Slovénie",
	"SK" : "Slovaquie",
	"SL" : "Sierra Leone",
	"SM" : "Saint-Marin",
	"SN" : "Sénégal",
	"SO" : "Somalie",
	"SR" : "Suriname",
	"SS" : "Soudan Du Sud",
	"ST" : "Sao Tomé-Et-Principe",
	"SV" : "Salvador",
	"SY" : "Syrie",
	"SZ" : "Swaziland",
	"TD" : "Tchad",
	"TG" : "Togo",
	"TH" : "Thaïlande",
	"TJ" : "Tadjikistan",
	"TL" : "Timor-Oriental",
	"TM" : "Turkménistan",
	"TN" : "Tunisie",
	"TO" : "Tonga",
	"TR" : "Turquie",
	"TT" : "Trinité-Et-Tobago",
	"TV" : "Tuvalu",
	"TW" : "Taïwan",
	"TZ" : "Tanzanie",
	"UA" : "Ukraine",
	"UG" : "Ouganda",
	"US" : "États-Unis",
	"UY" : "Uruguay",
	"UZ" : "Ouzbékistan",
	"VA" : "Vatican",
	"VC" : "Saint-Vincent-Et-Les Grenadines",
	"VE" : "Venezuela",
	"VN" : "Viet Nam",
	"VU" : "Vanuatu",
	"WS" : "Samoa",
	"YE" : "Yémen",
	"ZA" : "Afrique Du Sud",
	"ZM" : "Zambie",
	"ZW" : "Zimbabwe",
	"LB" : "Liban",
}
let paysSimplifie = {
	"AE" : "Emirats Arabes Unis",
	"AF" : "Afghanistan",
	"AL" : "Albanie",
	"AM" : "Arménie",
	"AO" : "Angola",
	"AR" : "Argentine",
	"AT" : "Autriche",
	"AU" : "Australie",
	"AZ" : "Azerbaïdjan",
	"BA" : "Bosnie-Herzégovine",
	"BD" : "Bangladesh",
	"BE" : "Belgique",
	"BF" : "Burkina Faso",
	"BG" : "Bulgarie",
	"BI" : "Burundi",
	"BJ" : "Bénin",
	"BN" : "Bruneï",
	"BO" : "Bolivie",
	"BR" : "Brésil",
	"BT" : "Bhoutan",
	"BW" : "Botswana",
	"BY" : "Biélorussie",
	"BZ" : "Belize",
	"CA" : "Canada",
	"CD" : "République Démocratique Du Congo",
	"CF" : "République Centrafricaine",
	"CG" : "Congo",
	"CH" : "Suisse",
	"CI" : "Côte D'Ivoire",
	"CL" : "Chili",
	"CM" : "Cameroun",
	"CN" : "Chine",
	"CO" : "Colombie",
	"CR" : "Costa Rica",
	"CU" : "Cuba",
	"CZ" : "République Tchèque",
	"DE" : "Allemagne",
	"DJ" : "Djibouti",
	"DK" : "Danemark",
	"DO" : "République Dominicaine",
	"DZ" : "Algérie",
	"EC" : "Equateur",
	"EE" : "Estonie",
	"EG" : "Egypte",
	"EH" : "Sahara Occidental",
	"ER" : "Erythrée",
	"ES" : "Espagne",
	"ET" : "Éthiopie",
	"FI" : "Finlande",
	"FJ" : "Fidji",
	"FR" : "France",
	"GA" : "Gabon",
	"GB" : "Royaume-Uni",
	"GE" : "Géorgie",
	"GH" : "Ghana",
	"GL" : "Groenland",
	"GM" : "Gambie",
	"GN" : "Guinée",
	"GQ" : "Guinée Équatoriale",
	"GR" : "Grèce",
	"GT" : "Guatemala",
	"GW" : "Guinée-Bissau",
	"GY" : "Guyana",
	"HN" : "Honduras",
	"HR" : "Croatie",
	"HT" : "Haïti",
	"HU" : "Hongrie",
	"ID" : "Indonésie",
	"IE" : "Irlande",
	"IL" : "Israël",
	"IN" : "Inde",
	"IQ" : "Irak",
	"IR" : "Iran",
	"IS" : "Islande",
	"IT" : "Italie",
	"JM" : "Jamaïque",
	"JO" : "Jordanie",
	"JP" : "Japon",
	"KE" : "Kenya",
	"KG" : "Kirghizistan",
	"KH" : "Cambodge",
	"KP" : "Corée du Nord",
	"KR" : "Corée du Sud",
	"KW" : "Koweït",
	"KZ" : "Kazakhstan",
	"LA" : "Laos",
	"LB" : "Liban",
	"LK" : "Sri Lanka",
	"LR" : "Liberia",
	"LS" : "Lesotho",
	"LT" : "Lituanie",
	"LU" : "Luxembourg",
	"LV" : "Lettonie",
	"LY" : "Libye",
	"MA" : "Maroc",
	"MC" : "Monaco",
	"MD" : "Moldavie",
	"ME" : "Monténégro",
	"MG" : "Madagascar",
	"MK" : "Macédoine",
	"ML" : "Mali",
	"MM" : "Birmanie",
	"MN" : "Mongolie",
	"MR" : "Mauritanie",
	"MW" : "Malawi",
	"MX" : "Mexique",
	"MY" : "Malaisie",
	"MZ" : "Mozambique",
	"NA" : "Namibie",
	"NE" : "Niger",
	"NG" : "Nigéria",
	"NI" : "Nicaragua",
	"NL" : "Pays-Bas",
	"NO" : "Norvège",
	"NP" : "Népal",
	"NZ" : "Nouvelle-Zélande",
	"OM" : "Oman",
	"PA" : "Panama",
	"PE" : "Pérou",
	"PG" : "Papouasie-Nouvelle-Guinée",
	"PH" : "Philippines",
	"PK" : "Pakistan",
	"PL" : "Pologne",
	"PR" : "Porto Rico",
	"PS" : "Palestine",
	"PT" : "Portugal",
	"PY" : "Paraguay",
	"QA" : "Qatar",
	"RO" : "Roumanie",
	"RS" : "Serbie",
	"RU" : "Russie",
	"RW" : "Rwanda",
	"SA" : "Arabie Saoudite",
	"SD" : "Soudan",
	"SE" : "Suède",
	"SI" : "Slovénie",
	"SK" : "Slovaquie",
	"SL" : "Sierra Leone",
	"SN" : "Sénégal",
	"SO" : "Somalie",
	"SR" : "Suriname",
	"SS" : "Soudan Du Sud",
	"SV" : "Salvador",
	"SY" : "Syrie",
	"SZ" : "Swaziland",
	"TD" : "Tchad",
	"TG" : "Togo",
	"TH" : "Thaïlande",
	"TJ" : "Tadjikistan",
	"TL" : "Timor-Oriental",
	"TM" : "Turkménistan",
	"TN" : "Tunisie",
	"TR" : "Turquie",
	"TW" : "Taïwan",
	"TZ" : "Tanzanie",
	"UA" : "Ukraine",
	"UG" : "Ouganda",
	"US" : "États-Unis",
	"UY" : "Uruguay",
	"UZ" : "Ouzbékistan",
	"VE" : "Venezuela",
	"VN" : "Viet Nam",
	"YE" : "Yémen",
	"ZA" : "Afrique Du Sud",
	"ZM" : "Zambie",
	"ZW" : "Zimbabwe",
	"LB" : "Liban",
}
for([key, val] of Object.entries(pays)) {
    pays[key]=strNoAccent(val).toUpperCase();
  }
let keys = Object.keys(pays);
let values = Object.values(pays);
let keysSimplifie = Object.keys(paysSimplifie);
let valuesSimplifie = Object.values(paysSimplifie);
let number;
let triesNumber = 200;
let score = 0;
let score2 = 0;
let isOver=false;
let answerCode = '';
var countdownNumberEl = document.getElementById('countdown-number');
var countdown = 500;
function strNoAccent(a) {
    var b="áàâäãåçéèêëíïîìñóòôöõúùûüýÁÀÂÄÃÅÇÉÈÊËÍÏÎÌÑÓÒÔÖÕÚÙÛÜÝ",
        c="aaaaaaceeeeiiiinooooouuuuyAAAAAACEEEEIIIINOOOOOUUUUY",
        d="";
    for(var i = 0, j = a.length; i < j; i++) {
      var e = a.substr(i, 1);
      d += (b.indexOf(e) !== -1) ? c.substr(b.indexOf(e), 1) : e;
    }
    return d;
}
  
setInterval(diminuerTemps, 1000);
countdownNumberEl.textContent = countdown;

function diminuerTemps() {
    if (countdown>0) {
        countdown--;
        countdownNumberEl.textContent = countdown;
        if(countdown == 0)
        {
            gameOver();
        }
    }
    else {
        gameOver();
    }
}

function getRandomFlag() {
    let number = Math.floor(Math.random() * keysSimplifie.length);
	console.log(keysSimplifie[number])
    document.getElementById("flag").src = "https://flagcdn.com/160x120/" + keysSimplifie[number].toLowerCase() + ".png";
	answerCode = document.getElementById("flag").src.slice(28, 30).toUpperCase();
    keysSimplifie.splice(number, 1);
    valuesSimplifie.splice(number, 1);
}

function getKeyValue(ele) {
    if (ele === 'Start')
    {
        number = Math.floor(Math.random() * keys.length);
        document.getElementById("nomPays").innerHTML = pays[keys[number]].charAt(0)
    }
    if(event.key === 'Enter') {
        let input = document.getElementById("reponse");
        let answer = strNoAccent(input.value).toUpperCase();
        console.log(answer); 
        if (values.includes(answer) && answer.charAt(0)===pays[keys[number]].charAt(0)) {
            console.log(values)
            console.log(values.indexOf(answer));
            changeColor2(keys[values.indexOf(answer)], "green");
            keys.splice(values.indexOf(answer), 1);
            values.splice(values.indexOf(answer),1);

            number = Math.floor(Math.random() * keys.length);
            document.getElementById("nomPays").innerHTML = pays[keys[number]].charAt(0)
			score2+=1;
        }
		document.getElementById("score2").innerHTML="Score : " + score2;
       input.value = ""
    }
}
function changeColor(code, color) {
    var styles = '.mapsl #'+code+' {' +
        'fill: '+color+';' +
        '}';
    var styleSheet = document.createElement("style")
    styleSheet.innerText = styles
    document.head.appendChild(styleSheet)
}

function changeColor2(code, color) {
    var styles = '.mapsl2 #'+code+' {' +
        'fill: '+color+';'
        + 'opacity: 1;' + '}'
        ;

    var styleSheet = document.createElement("style")
    styleSheet.innerText = styles
    document.head.appendChild(styleSheet)
}

async function gameOver() {
    if (!isOver) {
        document.getElementById('mySvg').setAttribute("opacity", '0');
        countdownNumberEl.textContent = "";
        await sleep(100);
        isOver=true;
        changeColor(answerCode,"red");
        alert("GAME OVER");
        triesNumber=-1;
    }
}

function test(code) {
	console.log(pays[code]);
	console.log("answer code " + answerCode)
    if (isOver) {
        return;
    }
    if(answerCode == code) {
        score ++;
        changeColor(answerCode,"green");
        try {
            getRandomFlag();
        } catch {
            console.log("Periode d'essai terminée");
        }
    }
    else{
        triesNumber --;
        changeColor(answerCode,"red");
        if(triesNumber < 0){
            gameOver();
        }
        if (triesNumber>=0) {
            getRandomFlag();
            document.getElementById("tries").innerHTML = 'Tentatives restantes : ' + triesNumber;
        }
    }
    document.getElementById("score").innerHTML = 'Score : ' + score;
    console.log("essais restant:" + triesNumber);
    console.log("score :" + score);
}
function sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
}
